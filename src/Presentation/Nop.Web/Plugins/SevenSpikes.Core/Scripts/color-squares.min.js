/*
* Copyright 2019 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

!function(t,e,r){function o(){var t=[];return e(d).each(function(){var r=e(this).attr("data-productid");if(r&&r>0){var o={productId:r,productElement:e(this)};t.push(o)}}),t}function a(t,o){var a=r.getAttrValFromDom(i,"data-productbox-container-selector");if(a){var u=o.productElement.find(a);if(!(u.find("ul.attribute-squares").length>0)&&u&&o.productId&&o.productId>0){var c=o.productId,d=e(t).filter("ul[data-productId='"+c+"']");if(d&&d.length>0){e(u).append(d),e(u).addClass("active");var n=e(".product-item").has("[data-productid="+c+"]");n.find(" .second-product-image").remove(),n.find(".product-box-attribute-square.preselected").click()}}}}function u(t,e){if(e&&e.length>0)for(var r=0;r<e.length;r++)a(t,e[r])}function c(){return r.getAttrValFromDom(i,"data-retrieve-color-squares-url")}var d,i="#color-squares-info";t.getColorSquares=function(){var t=o();if(t&&0!==t.length){for(var r=[],a=0;a<t.length;a++){var d=t[a];d.hasOwnProperty("productId")&&r.push(d.productId)}var i={productIds:r},n=c();e.ajax({type:"POST",data:e.toJSON(i),contentType:"application/json; charset=utf-8",url:n}).done(function(r){r&&(u(r,t),e.event.trigger({type:"colorSquaresLoadingCompleteEvent"}))})}},e(document).ready(function(){(d=r.getAttrValFromDom(i,"data-productbox-selector"))&&t.getColorSquares()}),e(document).on("click",".product-box-attribute-square",function(){var t=e(this),o=t.closest("li");if(!o.hasClass("selected-value")){var a=r.getAttrValFromDom("#color-squares-info","data-product-attribute-change-url"),u=t.closest(".product-item").data("productid");if(u&&u>0){var c={};c[t.attr("name")]=t.attr("value"),e.ajax({cache:!1,url:a+"?productId="+u+"&validateAttributeConditions=true&loadpicture=true",data:c,type:"POST",success:function(e){if(e.price){var o=r.getAttrValFromDom("#color-squares-info","data-productbox-price-selector"),a=t.closest(".product-item").find(o);a.length>0&&a.text(e.price)}e.pictureDefaultSizeUrl&&t.closest(".product-item").find(".picture img").attr("src",e.pictureDefaultSizeUrl)}})}o.addClass("selected-value"),o.siblings(".selected-value").removeClass("selected-value")}}),e(document).on("nopAjaxFiltersFiltrationCompleteEvent newProductsAddedToPageEvent",t.getColorSquares)}(window.colorSquares=window.colorSquares||{},jQuery,sevenSpikesCore);